<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8" />
    <title>BERLIO Vertex</title>

    <style>
        html,
        body {
            margin: 0;
            background: #050505;
            overflow: hidden;
        }

        canvas {
            display: block;
        }
    </style>
</head>

<body>

    <canvas id="c"></canvas>

    <script>
        /* ===========================
           CONFIG
        =========================== */

        // === пути (сокращенные) ===
        const paths = [
            // b (красный)
            'M123.43 17.66L96.43 17.71 88.93 49.08C88.69 50.06 88.56 51.44 89.05 51.76 89.35 51.96 89.9 52.07 90.25 52.07L111.52 52.07C112.53 52.07 114.17 52.02 115.18 51.94 121.74 51.48 128.25 50.87 131.83 43.75 132.03 43.36 132.25 42.69 132.32 42.26 133.1 37.54 130.99 36.12 128.72 35.01 128.52 34.92 128.21 34.74 128.04 34.6 127.6 34.21 127.36 33.72 127.59 33.22 127.85 32.64 128.9 32.19 129.46 31.87 132.02 30.43 133.62 28.44 134.04 25.78 134.11 25.33 134.12 24.58 134.06 24.12 133.51 20 130 18.24 124.94 17.72 124.52 17.68 123.85 17.66 123.43 17.66z M110.21 24.64L115.84 24.67C116.2 24.67 116.77 24.72 117.12 24.78 118.55 25.05 119.81 25.48 119.99 26.88 120.05 27.35 119.88 28.12 119.67 28.54 119.05 29.81 117.9 30.61 116.25 30.96 115.68 31.09 114.72 31.12 114.13 31.12L107.94 31.12A0.51 0.51 0 0 1 107.44 30.49L108.45 26.11C108.53 25.76 108.63 25.15 108.9 24.93 108.97 24.87 109.05 24.83 109.13 24.79 109.41 24.66 109.91 24.64 110.21 24.64z M107.76 37.58L113.87 37.64C114.29 37.64 114.98 37.68 115.39 37.75 116.76 37.96 117.98 38.39 118.56 39.81 118.75 40.28 118.71 41.09 118.5 41.55 117.68 43.35 115.99 44.25 113.67 44.51 113.07 44.57 112.09 44.58 111.49 44.58L104.11 44.6 105.52 38.54C105.55 38.42 105.62 38.23 105.68 38.13 105.74 38.04 105.8 37.95 105.88 37.87 106.26 37.51 107.22 37.57 107.76 37.58z',
            // e (красный)
            'm145.09 18.62c0.2-0.62 0.64-0.97 1.38-0.99l34.65-0.03c0.77 0.1 1.42 0.35 1.21 1.43l-1.09 5.07c-0.26 0.67-0.79 0.81-1.39 0.79l-21.25 0.08c-0.48 0.02-0.93 0.16-1.16 0.77l-0.83 3.55c0.07 0.53 0.27 0.97 0.99 1.1l19.4 0.06c0.41 0.16 0.75 0.41 0.77 1.16l-1.14 4.86c-0.25 0.6-0.62 0.95-1.22 0.9l-19.74 0.01c-0.55 0-0.92 0.27-1.16 0.72l-1.14 4.93c0.15 0.57 0.44 0.98 0.99 1.11l21.48 0.01c0.55 0.14 0.98 0.41 1.04 1.1l-1.32 5.86c-0.17 0.56-0.6 0.67-1.01 0.8h-35.63c-0.75-0.02-1.26-0.3-1.27-1.16z',
            // R (зеленый)
            'M144.41 12C161.62 5.55 179.51 1.04 199.1 1.35c13.89-0.16 34.17 5.29 43.33 14.47 3.47 3.97 4.19 7.86 0.49 11.63-3.54 3.06-8.62 5.68-16.34 7.55-0.73 0.32-0.81 0.74-0.86 1.16-0.24 6.66 3.1 10.13 6.36 13.68 11.89 8.7 27.3 11.64 47.36 6.95l24.67 0.04c-27.04 12.88-58.46 11.48-80.04-1.12-6-4.18-11.8-8.61-14.77-16.9-0.26-0.69-0.7-1.11-1.38-1.16h-3.55c-0.9 0.3-0.93 0.66-1.16 1.01l-3.4 14.36c-0.2 0.51-0.63 0.9-1.46 0.89l-14.72 0.02c-0.88-0.14-1.23-0.76-1.13-1.62l9.64-39.51c0.15-0.48 0.45-0.88 1.2-1.01l15.07 0.15c0.8 0.06 1.37 0.44 1.38 1.57l-3.96 14.47c-0.23 1.01 0.31 1.51 1.27 1.72 4.59-0.02 8.88-0.89 12.9-3.23 4.22-3.05 4.33-6.99 0.52-11.8C216.94 10.93 211.25 8.59 202.73 8.11 185.85 7.53 171.33 9.52 159.1 14.02l-14.62 0.09C143.56 13.65 142.83 13.01 144.41 12Z',
            // l (красный)
            'm251.7 17.66l12.64 0.05c0.51 0.18 0.94 0.34 0.9 1.48l-5.39 22.79c-0.15 0.77 0.13 1.33 1.11 1.53h18.82c0.62 0.15 1.24 0.42 1.16 1.27l-1.53 6.4c-0.26 0.4-0.52 0.8-1.27 0.79l-33.15 0.05c-0.84-0.12-0.99-0.73-1.22-1.32z',
            // i (красный)
            'm294.26 17.6l12.58 0.05c0.72 0.19 1.19 0.6 1.11 1.48l-7.67 31.88c-0.24 0.65-0.78 0.81-1.37 0.9l-11.42-0.05c-0.63-0.19-1.12-0.5-1.06-1.32z',
            // o (красный)
            'M337.77 16.99C328.08 17.34 322.31 20.59 317.82 24.79 317.43 25.15 316.87 25.81 316.56 26.25 311.35 33.83 309.79 40.92 314.83 47.09 315.06 47.37 315.47 47.78 315.76 48.01 319.89 51.38 326.16 53.44 338.14 52.03 338.9 51.94 340.12 51.71 340.86 51.52 349.65 49.21 356.54 44.71 359.16 35.28 359.46 34.22 359.77 32.46 359.83 31.37 360.31 22.06 353.37 18.64 347.16 17.53 345.8 17.29 343.55 17.09 342.17 17.03 340.61 16.95 339.15 16.94 337.77 16.99z M338.55 24.99C339.54 25.02 341.14 25.25 342.06 25.6 344.56 26.55 345.45 28.31 345.74 30.37 345.88 31.3 345.7 32.82 345.49 33.75 344.83 36.66 344.03 39.54 341.39 41.93 340.8 42.47 339.67 43.11 338.92 43.41 335.76 44.64 332.39 45.19 328.67 43.4 328.08 43.12 327.25 42.46 326.9 41.91 325.5 39.7 325.56 36.48 327.2 32.16 327.54 31.28 328.23 29.92 328.82 29.18 331.3 26.03 334.65 24.88 338.55 24.99z',
            // точка над i (зеленый)
            'm313.77 6.43a9.96 6.26 0 0 1-9.96 6.26 9.96 6.26 0 0 1-9.96-6.26 9.96 6.26 0 0 1 9.96-6.26 9.96 6.26 0 0 1 9.96 6.26z',
            // C (красный)
            'm14.1 52.03q-6.71 0-10.35-3.29-3.64-3.31-3.64-9.46 0-4.87 1.6-8.82 1.62-3.95 4.44-6.84 2.75-2.8 6.6-4.38 3.87-1.58 8.11-1.58 3.42 0 6.35 0.71 2.93 0.69 5.29 2.04l-1.96 8.02h-0.98q-2.11-2.27-4.2-3.33-2.09-1.07-4.91-1.07-4.95 0-8.18 3.98-3.2 3.98-3.2 10.13 0 3.95 1.78 5.73 1.78 1.78 5.2 1.78 3.07 0 5.75-1.22 2.69-1.24 5.09-3.15h0.89l-1.93 7.91q-1 0.4-2.33 0.98-1.33 0.56-2.55 0.91-1.6 0.47-3 0.71-1.38 0.24-3.87 0.24z',
            // M (красный)
            'm130.63 52.13h-8.91l5.22-22.59-9.49 14.47h-6.15l-3.06-15.42-5.43 23.54h-8.44l7.98-34.53h10.23l3.78 17.33 11.74-17.33h10.51z',
            // A (красный)
            'm174.2 52.13h-8.98l-0.79-7.05h-12.71l-4.04 7.05h-9.3l20.71-34.53h10.3zM163.77 38.89L162.37 26.48 155.25 38.89z',
            // T (красный)
            'm280.58 24.28h-10.76l-6.42 27.86h-8.95l6.42-27.86h-10.76l1.53-6.68h30.48z',
            // A (красный)
            'm314.2 52.13h-8.98l-0.79-7.05h-12.71l-4.04 7.05h-9.3L299.09 17.6h10.3zm-10.43-13.24-1.4-12.41-7.12 12.41z',
            // Дополнительные символы (светло-голубые)
            // 1
            'M75.04 52.04H52.16l1.39-5.99h7.2L64.9 27.93h-7.2l1.29-5.59q1.58 0 3.2-0.21 1.64-0.21 2.71-0.67 1.2-0.53 2.07-1.43 0.88-0.92 1.29-2.37h7.65l-6.54 28.38h7.04z',
            // 2
            'M75.74 52.03H49.27l1.29-5.57q3.76-2.4 7.06-4.73 3.31-2.33 5.59-4.19 3.53-2.85 5.18-5.12 1.65-2.29 1.65-4.37 0-1.97-1.31-2.9-1.31-0.95-3.62-0.95-2.35 0-4.8 0.82-2.45 0.79-4.66 2.24h-0.72l1.68-7.49q1.68-0.68 5.05-1.38 3.37-0.72 6.38-0.72 5.46 0 8.35 2.02 2.9 2.02 2.9 6 0 4.12-2.17 7.29-2.17 3.15-6.91 6.88-2.33 1.83-4.46 3.28-2.11 1.45-3.67 2.45h15.15z',
            // 3
            'm72.64 49.04q-2.22 1.59-5.05 2.43-2.81 0.81-6.29 0.81-4.07 0-7.25-0.74-3.19-0.76-5.21-1.8l1.57-7.28 0.88 0.02q2.04 1.46 4.58 2.34 2.54 0.88 5.01 0.88 3.62 0 5.64-1.35 2.04-1.37 2.04-3.89 0-1.06-0.4-1.73Q67.78 38.06 66.9 37.67 65.96 37.24 64.52 37.13 63.08 37 61.29 37h-1.84l1.28-5.93h1.91q4.6 0 6.42-0.99 1.84-1.01 1.84-3.05 0-1.62-1.55-2.38-1.53-0.76-4.25-0.76-2.34 0-4.9 0.74-2.56 0.74-4.58 1.75l-0.83-0.02 1.55-7.21q2-0.67 4.96-1.19 2.99-0.54 5.84-0.54 2.88 0 5.14 0.45 2.27 0.43 3.89 1.3 1.71 0.92 2.63 2.34 0.94 1.42 0.94 3.55 0 2.04-0.72 3.62-0.7 1.55-1.89 2.58-1.15 1.01-2.63 1.66-1.48 0.65-2.9 0.97l-0.07 0.31q2.45 0.4 4.09 1.95 1.66 1.55 1.66 4.02 0 2.79-1.26 5.08-1.26 2.27-3.39 3.8z',
            // 4
            'm78.08 43.82h-4.56l-1.8 7.79h-8.24l1.8-7.79H49.09l1.46-6.33 20.12-19.41h8.78L74.94 37.71H79.5ZM66.69 37.71 69.43 25.85 57.19 37.71Z',
            // 5
            'm71.71 48.7q-2.27 1.59-5.32 2.4-3.03 0.81-6.47 0.81-4.18 0-7.14-0.61-2.94-0.58-4.72-1.42l1.71-7.39h0.94q2.18 1.42 4.33 2.13 2.16 0.7 4.58 0.7 3.64 0 5.84-1.35 2.22-1.35 2.22-4.16 0-2.13-1.84-3.19-1.82-1.08-5.59-1.08-1.66 0-3.53 0.31-1.86 0.31-3.37 0.76h-0.99l4.36-18.87h23.79l-1.48 6.4H63.35l-1.26 5.46q0.31-0.02 0.81-0.02 0.49 0 1.19 0 2.56 0 4.81 0.47 2.25 0.47 4 1.53 1.75 1.06 2.79 2.76 1.03 1.68 1.03 4.2 0 3.44-1.37 5.97-1.35 2.54-3.64 4.16z',
            // 6
            'm62.57 52.24q-2.76 0-5.05-0.65-2.27-0.65-3.91-2.07-1.64-1.42-2.54-3.64-0.9-2.22-0.9-5.37 0-5.05 1.46-9.25 1.48-4.2 4.22-7.3 2.67-3.03 6.67-4.76 4-1.75 8.78-1.75 1.8 0 4.04 0.31 2.25 0.29 3.05 0.49l-1.15 6.54-0.85-0.04q-0.52-0.29-2.09-0.74-1.55-0.47-3.53-0.47-3.84 0-6.56 1.91-2.7 1.91-4.11 5.88 1.73-0.88 3.71-1.46 2-0.58 4.13-0.58 4.47 0 7.05 2.34 2.58 2.31 2.58 6.49 0 6.09-4.29 10.11-4.27 4.02-10.74 4.02zm6.15-12.83q0-2.34-1.39-3.39-1.39-1.08-4.02-1.08-1.15 0-2.22 0.25-1.08 0.22-1.77 0.43-0.25 0.94-0.45 2.31-0.18 1.37-0.18 2.47 0 3.14 1.03 4.65 1.03 1.5 3.48 1.5 2.27 0 3.89-2 1.64-2.02 1.64-5.14z',
            // 7
            'M79.04 24.55L57.81 51.57H48.04L70.01 24.3H52.87l1.44-6.18h26.21z',
            // 8
            'm79.77 24.95q0 2.79-1.98 5.03-1.98 2.22-5.71 3.57l-0.02 0.13q2.56 1.21 4 2.88 1.44 1.66 1.44 4.22 0 5.19-4.38 8.38-4.38 3.17-11.07 3.17-6.13 0-9.7-2.25-3.55-2.27-3.55-6.15 0-3.39 2.04-5.77 2.07-2.4 6.33-3.82l0.02-0.13q-2.2-1.3-3.28-2.74-1.08-1.44-1.08-3.55 0-2.16 0.9-4 0.92-1.86 2.76-3.37 1.8-1.46 4.49-2.31 2.7-0.88 6.18-0.88 5.91 0 9.25 2.07 3.35 2.07 3.35 5.53zm-8.65 1.35q0-1.55-1.26-2.4-1.24-0.88-3.17-0.88-2.31 0-3.73 1.1-1.39 1.08-1.39 2.7 0 1.03 0.58 1.71 0.61 0.65 1.91 1.3 0.63 0.31 1.64 0.74 1.03 0.43 2.4 0.94 1.26-1.15 2.13-2.45 0.88-1.3 0.88-2.76zm-2.36 15.75q0-1.17-0.63-1.98-0.63-0.83-2.67-1.86-0.65-0.34-1.98-0.88-1.33-0.56-2.25-0.97-1.86 1.39-2.76 2.88-0.9 1.48-0.9 3.1 0 2.02 1.5 3.14 1.53 1.12 3.95 1.12 2.25 0 3.98-1.28 1.75-1.28 1.75-3.28z'
        ];

        const TOTAL_POINTS = 3000;

        /* ===========================
           CANVAS
        =========================== */
        const canvas = document.getElementById('c');
        const ctx = canvas.getContext('2d');

        /* ===========================
           STATE
        =========================== */
        let vertices = [];
        let scale = 1;
        let offsetX = 0;
        let offsetY = 0;
        let lastTime = performance.now();
        let globalTime = 0;
        let timelineIndex = 0;

        /* ===========================
           PALETTE
        =========================== */
        const PALETTE = {
            red: { h: 3, s: 75, l: 55 },
            green: { h: 140, s: 55, l: 50 },
            blue: { h: 180, s: 70, l: 95 }
        };

        const PATH_COLORS = [
            'red', 'red', 'green', 'red', 'red', 'red', 'green',
            'red', 'red', 'red', 'red', 'red',
            'blue', 'blue', 'blue', 'blue', 'blue', 'blue', 'blue', 'blue'
        ];

        function hsl({ h, s, l }, a = 1) { return `hsla(${h}, ${s}%, ${l}%, ${a})`; }

        /* ===========================
           LETTER STATES (GROUP)
        =========================== */
        const LetterState = {
            OFF: 'off',
            GLITCH: 'glitch',
            DRAW_SEQ: 'draw_seq',
            DRAW_FULL: 'draw_full',
            ON: 'on'
        };

        /* ===========================
           VERTEX STATES
        =========================== */
        const VertexState = {
            OFF: 'off',
            ON: 'on',
            GLITCH: 'glitch'
        };

        const VertexVisualMatrix = {
            off: { visible: false, glow: { outer: 0, inner: 0, mid: 0 } },
            on: { visible: true, glow: { outer: 12, inner: 0.035, mid: 0.018 } },
            glitch: {
                visible: true, glow: {
                    outer: () => 8 + Math.random() * 4,
                    inner: () => 0.03 + Math.random() * 0.1,
                    mid: () => 0.015 + Math.random() * 0.1
                }
            }
        };

        /* ===========================
           VERTEX
        =========================== */
        class Vertex {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.radius = 1.6;
                this.state = VertexState.OFF;
            }

            draw(ctx, color) {
                const visual = VertexVisualMatrix[this.state];

                if (!visual.visible) return;

                const outer = typeof visual.glow.outer === 'function' ? visual.glow.outer() : visual.glow.outer;
                const inner = typeof visual.glow.inner === 'function' ? visual.glow.inner() : visual.glow.inner;
                const mid = typeof visual.glow.mid === 'function' ? visual.glow.mid() : visual.glow.mid;

                if (outer > 0) {
                    const glowRadius = this.radius * outer * (scale / 1.2);
                    const grad = ctx.createRadialGradient(this.x, this.y, this.radius, this.x, this.y, glowRadius);
                    grad.addColorStop(0, color.replace('1)', `${inner})`));
                    grad.addColorStop(0.4, color.replace('1)', `${mid})`));
                    grad.addColorStop(1, color.replace('1)', '0)'));
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, glowRadius, 0, Math.PI * 2);
                    ctx.fillStyle = grad;
                    ctx.fill();
                }

                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = color;
                ctx.fill();
            }
        }

        /* ===========================
           SVG UTILS
        =========================== */
        function getPointsFromPath(pathStr, count) {
            const p = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            p.setAttribute('d', pathStr);
            const len = p.getTotalLength();
            const pts = [];
            for (let i = 0; i <= count; i++) {
                const pt = p.getPointAtLength((i / count) * len);
                pts.push({ x: pt.x * scale + offsetX, y: pt.y * scale + offsetY });
            }
            return pts;
        }

        /* ===========================
           INIT VERTICES + GROUPS
        =========================== */
        let groups = [];
        function initVertices() {
            vertices = [];
            groups = [];

            const lengths = paths.map(p => {
                const t = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                t.setAttribute('d', p);
                return t.getTotalLength();
            });

            const totalLen = lengths.reduce((a, b) => a + b, 0);

            paths.forEach((p, i) => {
                const portion = lengths[i] / totalLen;
                const count = Math.max(10, Math.floor(TOTAL_POINTS * portion));
                const pts = getPointsFromPath(p, count);

                const colorKey = PATH_COLORS[i];
                const colorHSL = PALETTE[colorKey];

                const groupVertices = pts.map(pt => new Vertex(pt.x, pt.y));

                groups.push({
                    id: i,
                    vertices: groupVertices,
                    color: colorHSL,
                    state: LetterState.OFF,
                    stateTime: 0,
                    progress: 0
                });

                vertices.push(...groupVertices);
            });
        }

        /* ===========================
           GROUP UPDATE
        =========================== */
        const GROUP_TIME = 900;

        function updateGroup(group, time) {
            switch (group.state) {
                case LetterState.OFF:
                    group.vertices.forEach(v => v.state = VertexState.OFF);
                    break;
                case LetterState.GLITCH:
                    group.vertices.forEach(v => v.state = VertexState.GLITCH);
                    break;
                case LetterState.DRAW_SEQ: {
                    const p = Math.min((time - group.stateTime) / GROUP_TIME, 1);
                    const count = Math.floor(p * group.vertices.length);
                    group.vertices.forEach((v, i) => {
                        v.state = (i < count) ? VertexState.ON : VertexState.OFF;
                    });
                    break;
                }
                case LetterState.DRAW_FULL:
                case LetterState.ON:
                    group.vertices.forEach(v => v.state = VertexState.ON);
                    break;
            }
        }

        /* ===========================
   TIMELINE
=========================== */
        const TIMELINE = [
            // 1. всё off
            {
                at: 0,
                actions: [{ all: true, state: LetterState.OFF }]
            },

            // 2. отсчёт 3-2-1 — старт через 200ms
            { at: 500, actions: [{ letter: 14, state: LetterState.ON, duration: 600 }] },
            { at: 1100, actions: [{ letter: 14, state: LetterState.OFF }] },

            { at: 1150, actions: [{ letter: 13, state: LetterState.ON, duration: 600 }] },
            { at: 1750, actions: [{ letter: 13, state: LetterState.OFF }] },

            { at: 1800, actions: [{ letter: 12, state: LetterState.ON, duration: 600 }] },
            { at: 2400, actions: [{ letter: 12, state: LetterState.OFF }] },

            // 3. i-dot glitch + off/on/off/on/off
            { at: 2450, actions: [{ letter: 6, state: LetterState.GLITCH, duration: 1500 }] },
            { at: 3450, actions: [{ letter: 6, state: LetterState.OFF }] },
            { at: 3500, actions: [{ letter: 6, state: LetterState.GLITCH }] },
            { at: 3650, actions: [{ letter: 6, state: LetterState.OFF }] },
            { at: 3700, actions: [{ letter: 6, state: LetterState.GLITCH }] },
            { at: 3750, actions: [{ letter: 6, state: LetterState.OFF }] },

            // 4. b e R l i o i-dot draw-seq
            {
                at: 3900,
                actions: [0, 1, 2, 3, 4, 5, 6].map(i => ({
                    letter: i,
                    state: LetterState.DRAW_SEQ
                }))
            },

            // 5. второй glitch i-dot + перед выключением
            { at: 5000, actions: [{ letter: 6, state: LetterState.GLITCH, duration: 1500 }] },
            { at: 6100, actions: [{ letter: 6, state: LetterState.OFF }] },
            { at: 6300, actions: [{ letter: 6, state: LetterState.GLITCH }] },
            { at: 6500, actions: [{ letter: 6, state: LetterState.OFF }] },

            // 6. выключаем BERLIO
            {
                at: 6700,
                actions: [0, 1, 3, 4, 5, 6].map(i => ({
                    letter: i,
                    state: LetterState.OFF
                }))
            },

            { at: 7900, actions: [{ letter: 2, state: LetterState.ON }] },

            // 7. отсчёт 1–8 начинается сразу после BERLIO
            ...Array.from({ length: 8 }, (_, idx) => {
                const letterIndex = 12 + idx; // Буквы от 12 до 19 (1-8)
                const events = [];

                // Включение
                events.push({
                    at: 7900 + idx * 150, // старт сразу после BERLIO
                    actions: [{ letter: letterIndex, state: LetterState.ON, duration: 100 }]
                });

                // Выключение
                events.push({
                    at: 7900 + idx * 150 + 100,
                    actions: [{ letter: letterIndex, state: LetterState.OFF }]
                });

                return events;
            }).flat(),

            { at: 7900, actions: [{ letter: 19, state: LetterState.ON }] },

            // 8. CMATA draw full
            {
                at: 9200,
                actions: [7, 8, 9, 10, 11].map(i => ({
                    letter: i,
                    state: LetterState.DRAW_FULL
                }))
            },

            // 9. всё off
            {
                at: 11500,
                actions: [{ all: true, state: LetterState.OFF }]
            }
        ];

        const TIMELINE_DURATION = 11500; // новая длительность




        function applyActions(actions, time) {
            actions.forEach(a => {
                if (a.all) {
                    groups.forEach(g => {
                        g.state = a.state;
                        g.stateTime = time;
                    });
                } else {
                    const g = groups[a.letter];
                    g.state = a.state;
                    g.stateTime = time;
                    if (a.duration) g.autoOffAt = time + a.duration;
                }
            });
        }

        /* ===========================
           ANIMATE
        =========================== */
        function animate(time) {
            const dt = time - lastTime;
            lastTime = time;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            globalTime += dt;

            while (timelineIndex < TIMELINE.length && globalTime >= TIMELINE[timelineIndex].at) {
                applyActions(TIMELINE[timelineIndex].actions, globalTime);
                timelineIndex++;
            }

            if (globalTime > TIMELINE_DURATION) {
                globalTime = 0;
                timelineIndex = 0;
            }

            groups.forEach(g => updateGroup(g, globalTime));

            groups.forEach(g => {
                const color = hsl(g.color);
                g.vertices.forEach(v => v.draw(ctx, color));
            });

            requestAnimationFrame(animate);
        }

        /* ===========================
           RESIZE
        =========================== */
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            const logoW = 360, logoH = 66;
            scale = Math.min(canvas.width / (logoW * 2), canvas.height / (logoH * 2));
            offsetX = (canvas.width - logoW * scale) / 2;
            offsetY = (canvas.height - logoH * scale) / 2;
        }

        /* ===========================
           BOOT
        =========================== */
        resizeCanvas();
        initVertices();
        requestAnimationFrame(animate);
        window.addEventListener('resize', () => {
            resizeCanvas();
            initVertices();
        });
    </script>


</body>

</html>