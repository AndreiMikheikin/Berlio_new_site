import{r as l,j as e,D as A,P as u,u as L,L as D,H as M}from"./index-BcP1mcEX.js";import{H as T,N as H,S as I,F as K,a as V}from"./SecondaryFooter-atIk67Jk.js";import{s as C}from"./slugify-DkYYXQXP.js";import{u as y}from"./useTranslation-CFJr0cbq.js";import{n as z}from"./newsData-CPduxGqq.js";function P({options:a,selectedOption:w,onSelect:m,openFillColor:r="#000",closedFillColor:o="#777"}){const{t:x}=y(),[_,g]=l.useState(!1),[h,j]=l.useState(o),c=n=>{g(!1),m(n)};l.useEffect(()=>{const n=b=>{b.target.closest(".aam_sort-dropdown")||(g(!1),j(o))};return document.addEventListener("click",n),()=>{document.removeEventListener("click",n)}},[o]);const k=()=>{g(!_),j(_?o:r)};return e.jsxs("div",{className:"aam_sort-dropdown",children:[e.jsx("span",{className:"aam_sort-dropdown__label",children:x("newsBlock.sortBy")}),e.jsxs("div",{children:[e.jsxs("button",{type:"button",className:"aam_sort-dropdown__header",onClick:k,children:[e.jsx("span",{className:`aam_sort-dropdown__text ${_?"open":""}`,children:w.label}),e.jsx(A,{className:`aam_sort-dropdown__icon ${_?"open":""}`,fillColor:h,width:"17",height:"9"})]}),_&&e.jsx("ul",{className:"aam_sort-dropdown__list",children:a.filter(n=>n.value!==w.value).map(n=>e.jsx("li",{className:"aam_sort-dropdown__item",children:e.jsx("button",{type:"button",onClick:()=>c(n),className:"aam_sort-dropdown__item-button",children:n.label})},n.value))})]})]})}P.propTypes={options:u.arrayOf(u.shape({value:u.string.isRequired,label:u.string.isRequired})).isRequired,selectedOption:u.shape({value:u.string.isRequired,label:u.string.isRequired}).isRequired,onSelect:u.func.isRequired,openFillColor:u.string,closedFillColor:u.string};const G=(a,w,m)=>{const r=a?new Date(a):null,o=w?new Date(w):null;return r===null&&(o===null||m<=o)||o===null&&r!==null&&m>=r||r!==null&&o!==null&&m>=r&&m<=o};function J(){const{t:a,i18n:w}=y(),m=w.language,r=L(),[o,x]=l.useState([]),[_,g]=l.useState(!0),[h,j]=l.useState("new"),[c,k]=l.useState(1),n=4,b=l.useMemo(()=>[{value:"new",label:a("newsBlock.newFirst")},{value:"old",label:a("newsBlock.oldFirst")}],[a]),F=l.useMemo(()=>b.find(t=>t.value===h)||b[0],[h,b.map(t=>t.label).join(",")]),S=l.useMemo(()=>new Date,[]);l.useEffect(()=>{(async()=>{try{const s=await fetch("/api/admin/news");if(!s.ok)throw new Error(`API error ${s.status}`);const i=await s.json(),f=Object.entries(i).map(([d,p])=>{const q=p.titles?.en||p.titles?.ru||`news-${d}`;return{id:d,...p,slug:p.slug||C(q,{lower:!0,strict:!0})}});x(f)}catch(s){console.warn("Ошибка загрузки API, используем fallback:",s.message);const i=Object.entries(z).map(([f,d])=>{const p=d.titles?.en||d.titles?.ru||`news-${f}`;return{id:f,...d,slug:d.slug||C(p,{lower:!0,strict:!0})}});x(i)}finally{g(!1)}})()},[]);const N=l.useMemo(()=>[...o.filter(i=>G(i.dates.startDate,i.dates.expireDate,S))].sort((i,f)=>{const d=new Date(i.dates.date),p=new Date(f.dates.date);return h==="new"?p-d:d-p}),[o,h,S]),v=Math.ceil(N.length/n),O=l.useMemo(()=>N.slice((c-1)*n,c*n),[N,c]),$=t=>{j(t.value),k(1)},E=t=>{k(t)},B=()=>{const t=[];for(let s=1;s<=v;s+=1)s===1||s===v||s>=c-1&&s<=c+1?t.push(e.jsx("button",{type:"button",className:`aam_news-block__pagination-button ${c===s?"active":""}`,onClick:()=>E(s),children:s},s)):(s===c-2||s===c+2)&&!t.find(i=>i.key===`dots-${s}`)&&t.push(e.jsx("span",{className:"aam_news-block__pagination-dots",children:"..."},`dots-${s}`));return t},R=t=>{const s={year:"numeric",month:"long",day:"numeric"};return new Date(t).toLocaleDateString(m,s)};return _?e.jsx("div",{className:"aam_news-block__loading",children:"Загрузка..."}):e.jsxs("main",{className:"aam_news-block",children:[e.jsxs("div",{className:"aam_news-block__breadcrumbs",children:[e.jsx(D,{to:"/",children:a("breadCrumbs.home")})," / ",a("breadCrumbs.news")]}),e.jsx("h1",{className:"aam_news-block__title",children:a("newsBlock.name")}),e.jsx(P,{options:b,selectedOption:F,onSelect:$,openFillColor:"#48AE5A",closedFillColor:"#000"}),e.jsx("div",{className:"aam_news-block__list",children:O.map(t=>e.jsxs("div",{className:"aam_news-block__item",role:"button",tabIndex:0,onClick:()=>r(`/news/${t.slug}`),onKeyDown:s=>{(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),r(`/news/${t.slug}`))},children:[e.jsx("p",{className:"aam_news-block__item-date",children:R(t.dates.date)}),e.jsx("h3",{className:"aam_news-block__item-title",children:t.titles[m]||t.titles.ru})]},t.id))}),v>1&&e.jsx("div",{className:"aam_news-block__pagination",children:B()}),e.jsx("div",{className:"aam_news-block__back",children:e.jsx(D,{to:"/",children:a("newsBlock.backHome")})})]})}function Z(){const{t:a}=y();return e.jsxs(e.Fragment,{children:[e.jsxs(M,{children:[e.jsx("title",{children:a("pageTitles.news")}),e.jsx("meta",{name:"description",content:"Описание новостей компании Берлио"}),e.jsx("meta",{name:"keywords",content:"Берлио, Новости"}),e.jsx("meta",{name:"author",content:"AndreiMikheikin"})]}),e.jsx(T,{}),e.jsx(H,{}),e.jsx(I,{placeholder:a("search")}),e.jsx(J,{}),e.jsx(K,{}),e.jsx(V,{})]})}export{Z as default};
//# sourceMappingURL=News-DjvJzIXc.js.map
