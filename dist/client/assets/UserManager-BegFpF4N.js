import{r as s,j as e,B as p,n as f}from"./index-RDm8gRJE.js";/* empty css                    */function y({onClose:o,onCreated:i}){const[d,x]=s.useState(""),[h,_]=s.useState(""),[u,j]=s.useState(!1),[c,l]=s.useState(""),m=async()=>{j(!0),l("");try{const t=localStorage.getItem("authToken"),n=await fetch("/api/admin/admins",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({username:d,password:h})});if(!n.ok){const a=await n.json();throw new Error(a?.error||"Ошибка создания")}i(),o()}catch(t){l(t.message)}finally{j(!1)}};return e.jsx("div",{className:"aam_modal",children:e.jsxs("div",{className:"aam_modal__content",children:[e.jsx("h3",{className:"aam_modal__title",children:"Создать администратора"}),c&&e.jsx("p",{className:"aam_modal__error",children:c}),e.jsx("input",{className:"aam_modal__input",type:"text",placeholder:"Имя пользователя",value:d,onChange:t=>x(t.target.value)}),e.jsx("input",{className:"aam_modal__input",type:"password",placeholder:"Пароль",value:h,onChange:t=>_(t.target.value)}),e.jsxs("div",{className:"aam_modal__actions",children:[e.jsx(p,{type:"submit",variant:"green",label:u?"Создание...":"Создать",onClick:m,disabled:u}),e.jsx(p,{type:"reset",variant:"green",label:"Отмена",onClick:o})]})]})})}function N({admin:o,onClose:i,onUpdated:d}){const[x,h]=s.useState(o.username),[_,u]=s.useState(""),[j,c]=s.useState(!1),[l,m]=s.useState(""),t=async()=>{c(!0),m("");try{const n=localStorage.getItem("authToken"),a=await fetch(`/api/admin/admins/${o.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({username:x,password:_||void 0})});if(!a.ok){const r=await a.json();throw new Error(r?.error||"Ошибка обновления")}d(),i()}catch(n){m(n.message)}finally{c(!1)}};return e.jsx("div",{className:"aam_modal",children:e.jsxs("div",{className:"aam_modal__content",children:[e.jsx("h3",{className:"aam_modal__title",children:"Редактировать администратора"}),e.jsx("input",{className:"aam_modal__input",type:"text",value:x,onChange:n=>h(n.target.value),placeholder:"Имя пользователя"}),e.jsx("input",{className:"aam_modal__input",type:"password",value:_,onChange:n=>u(n.target.value),placeholder:"Новый пароль (необязательно)"}),l&&e.jsx("p",{className:"aam_modal__error",children:l}),e.jsxs("div",{className:"aam_modal__actions",children:[e.jsx(p,{type:"submit",variant:"green",label:"Сохранить",onClick:t,disabled:j}),e.jsx(p,{type:"reset",variant:"green",label:"Отмена",onClick:i})]})]})})}function b({onConfirm:o,onCancel:i,username:d}){return e.jsx("div",{className:"aam_modal",children:e.jsxs("div",{className:"aam_modal__content",children:[e.jsx("h3",{className:"aam_modal__title",children:"Удаление администратора"}),e.jsxs("p",{className:"aam_modal__text",children:["Вы уверены, что хотите удалить ",e.jsx("strong",{children:d}),"?"]}),e.jsxs("div",{className:"aam_modal__actions",children:[e.jsx(p,{type:"submit",label:"Удалить",variant:"danger",onClick:o}),e.jsx(p,{type:"reset",label:"Отмена",variant:"green",onClick:i})]})]})})}function C(){const{role:o}=f(),[i,d]=s.useState([]),[x,h]=s.useState(!0),[_,u]=s.useState(!1),[j,c]=s.useState(null),[l,m]=s.useState(null);if(o!=="superadmin")return e.jsx("p",{children:"У вас нет прав для просмотра администраторов."});const t=()=>{h(!0);const a=localStorage.getItem("authToken");fetch("/api/admin/admins",{headers:{Authorization:`Bearer ${a}`}}).then(async r=>{if(!r.ok)throw new Error("Ошибка загрузки данных");const g=await r.json();d(g)}).catch(r=>console.error("Ошибка загрузки администраторов:",r)).finally(()=>h(!1))};s.useEffect(()=>{t()},[]);const n=async()=>{if(!l)return;const a=localStorage.getItem("authToken");try{const r=await fetch(`/api/admin/admins/${l.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}});if(!r.ok){const g=await r.json();throw new Error(g?.error||"Ошибка удаления")}m(null),t()}catch(r){alert(r.message)}};return x?e.jsx("p",{children:"Загрузка администраторов..."}):e.jsxs("div",{className:"aam_user-manager",children:[e.jsx("h2",{children:"Управление администраторами"}),o==="superadmin"&&e.jsx("button",{className:"aam-user-btn aam-user-btn--add",onClick:()=>u(!0),children:"➕ Новый админ"}),i.length===0?e.jsxs("p",{children:["Нет администраторов с ролью ",e.jsx("code",{children:"admin"}),"."]}):e.jsxs("table",{className:"aam_user-manager__table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Имя пользователя"}),e.jsx("th",{children:"Роль"}),e.jsx("th",{children:"Создан"}),e.jsx("th",{children:"Действия"})]})}),e.jsx("tbody",{children:i.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:a.id}),e.jsx("td",{children:a.username}),e.jsx("td",{children:a.role}),e.jsx("td",{children:new Date(a.created_at).toLocaleString("ru-RU")}),e.jsxs("td",{children:[e.jsx("button",{className:"aam-user-btn aam-user-btn--edit",onClick:()=>c(a),children:"✏️"}),e.jsx("button",{className:"aam-user-btn aam-user-btn--delete",onClick:()=>m(a),children:"🗑️"})]})]},a.id))})]}),_&&e.jsx(y,{onClose:()=>u(!1),onCreated:t}),j&&e.jsx(N,{admin:j,onClose:()=>c(null),onUpdated:t}),l&&e.jsx(b,{username:l.username,onConfirm:n,onCancel:()=>m(null)})]})}export{C as default};
//# sourceMappingURL=UserManager-BegFpF4N.js.map
