const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/quill-Cj_AQspS.js","assets/index-HWUfzzpA.js","assets/index-BXaW5Mvo.css"])))=>i.map(i=>d[i]);
import{r as s,_ as A,j as e,B as C,n as B}from"./index-HWUfzzpA.js";import{s as $}from"./slugify-DOqBg0Ac.js";/* empty css                    */function T({value:n,onChange:d,placeholder:u=""}){const h=s.useRef(null),o=s.useRef(null);return s.useEffect(()=>{let i;if(h.current)return A(async()=>{const{default:m}=await import("./quill-Cj_AQspS.js");return{default:m}},__vite__mapDeps([0,1,2])).then(({default:m})=>{i=new m(h.current,{theme:"snow",placeholder:u,modules:{toolbar:[[{header:[2,3,4,!1]}],["bold","italic","underline","link"],[{list:"ordered"},{list:"bullet"}],[{color:["#48AE5A","#F24942","#000000","#FFFFFF",!1]}],[{background:["#48AE5A","#F24942","#000000","#FFFFFF",!1]}],[{align:[]}],["clean"]]}}),n&&i.clipboard.dangerouslyPasteHTML(n),i.on("text-change",()=>{const _=i.root.innerHTML;d(_)}),o.current=i}),()=>{o.current&&(o.current.off("text-change"),o.current=null,i=null)}},[]),s.useEffect(()=>{o.current&&n!==o.current.root.innerHTML&&o.current.clipboard.dangerouslyPasteHTML(n||"")},[n]),e.jsx("div",{className:"custom-quill-editor",ref:h})}function L({onClose:n,onCreated:d}){const[u,h]=s.useState(""),[o,i]=s.useState("B"),[m,_]=s.useState(""),[y,p]=s.useState(""),[f,j]=s.useState(""),[x,N]=s.useState({ru:"",en:""}),[c,r]=s.useState({ru:"",en:""}),[g,w]=s.useState(!1),[S,b]=s.useState("");s.useEffect(()=>{if(!u.trim()){const a=x.ru||x.en;a.trim()&&h($(a,{lower:!0,strict:!0}))}},[x.ru,x.en]);const D=async()=>{w(!0),b("");const a={slug:u,priority:o,dates:{date:m,startDate:y,expireDate:f},titles:x,descriptions:c};try{const t=localStorage.getItem("authToken"),l=await fetch("/api/admin/news",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(a)});if(!l.ok){const v=await l.json();throw new Error(v?.error||"Ошибка создания новости")}d(),n()}catch(t){b(t.message)}finally{w(!1)}},E=(a,t)=>{N(l=>({...l,[a]:t}))},k=(a,t)=>{r(l=>({...l,[a]:t}))};return e.jsx("div",{className:"aam_modal",children:e.jsxs("div",{className:"aam_modal__content",children:[e.jsx("h3",{className:"aam_modal__title",children:"Создать новость"}),S&&e.jsx("p",{className:"aam_modal__error",children:S}),e.jsx("input",{className:"aam_modal__input",type:"text",placeholder:"Автоматически сгенерируется из заголовка",value:u,onChange:a=>h(a.target.value)}),e.jsxs("select",{className:"aam_modal__input",value:o,onChange:a=>i(a.target.value),children:[e.jsx("option",{value:"A",children:"Приоритет A"}),e.jsx("option",{value:"B",children:"Приоритет B"})]}),e.jsxs("label",{htmlFor:"publishDate",children:["Дата публикации",e.jsx("input",{className:"aam_modal__input",type:"date",id:"publishDate",value:m,onChange:a=>_(a.target.value)})]}),e.jsxs("label",{htmlFor:"startDate",children:["Начало отображения",e.jsx("input",{className:"aam_modal__input",type:"date",id:"startDate",value:y,onChange:a=>p(a.target.value)})]}),e.jsxs("label",{htmlFor:"expireDate",children:["Конец отображения",e.jsx("input",{className:"aam_modal__input",type:"date",id:"expireDate",value:f,onChange:a=>j(a.target.value)})]}),e.jsx("hr",{className:"aam_modal__divider"}),["ru","en"].map(a=>e.jsxs("div",{children:[e.jsxs("h4",{children:["Язык: ",a.toUpperCase()]}),e.jsx("input",{className:"aam_modal__input",type:"text",placeholder:`Заголовок (${a})`,value:x[a],onChange:t=>E(a,t.target.value)}),e.jsx(T,{value:c[a],onChange:t=>k(a,t),placeholder:`Описание (${a})`})]},a)),e.jsxs("div",{className:"aam_modal__actions",children:[e.jsx(C,{type:"submit",variant:"green",label:g?"Создание...":"Создать",onClick:D,disabled:g}),e.jsx(C,{type:"reset",variant:"green",label:"Отмена",onClick:n})]})]})})}function M({news:n,onClose:d,onUpdated:u}){const[h,o]=s.useState(n.slug),[i,m]=s.useState(n.priority),[_,y]=s.useState(n.dates?.date||""),[p,f]=s.useState(n.dates?.startDate||""),[j,x]=s.useState(n.dates?.expireDate||""),[N,c]=s.useState(n.titles||{ru:"",en:""}),[r,g]=s.useState(n.descriptions||{ru:"",en:""}),[w,S]=s.useState(!1),[b,D]=s.useState(""),E=async()=>{S(!0),D("");const t={slug:h,priority:i,dates:{date:_,startDate:p,expireDate:j},titles:N,descriptions:r};try{const l=localStorage.getItem("authToken"),v=await fetch(`/api/admin/news/${n.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify(t)});if(!v.ok){const F=await v.json();throw new Error(F?.error||"Ошибка обновления")}u(),d()}catch(l){D(l.message)}finally{S(!1)}},k=(t,l)=>{c(v=>({...v,[t]:l}))},a=(t,l)=>{g(v=>({...v,[t]:l}))};return e.jsx("div",{className:"aam_modal",children:e.jsxs("div",{className:"aam_modal__content",children:[e.jsx("h3",{className:"aam_modal__title",children:"Редактировать новость"}),b&&e.jsx("p",{className:"aam_modal__error",children:b}),e.jsx("input",{className:"aam_modal__input",type:"text",placeholder:"Slug",value:h,onChange:t=>o(t.target.value)}),e.jsxs("select",{className:"aam_modal__input",value:i,onChange:t=>m(t.target.value),children:[e.jsx("option",{value:"A",children:"Приоритет A"}),e.jsx("option",{value:"B",children:"Приоритет B"})]}),e.jsx("input",{className:"aam_modal__input",type:"date",placeholder:"Дата публикации",value:_,onChange:t=>y(t.target.value)}),e.jsx("input",{className:"aam_modal__input",type:"date",placeholder:"Начало отображения",value:p,onChange:t=>f(t.target.value)}),e.jsx("input",{className:"aam_modal__input",type:"date",placeholder:"Конец отображения",value:j,onChange:t=>x(t.target.value)}),e.jsx("hr",{className:"aam_modal__divider"}),["ru","en"].map(t=>e.jsxs("div",{children:[e.jsxs("h4",{children:["Язык: ",t.toUpperCase()]}),e.jsx("input",{className:"aam_modal__input",type:"text",placeholder:`Заголовок (${t})`,value:N[t],onChange:l=>k(t,l.target.value)}),e.jsx(T,{value:r[t],onChange:l=>a(t,l),placeholder:`Описание (${t})`})]},t)),e.jsxs("div",{className:"aam_modal__actions",children:[e.jsx(C,{type:"submit",variant:"green",label:w?"Сохранение...":"Сохранить",onClick:E,disabled:w}),e.jsx(C,{type:"reset",variant:"green",label:"Отмена",onClick:d})]})]})})}function P({onConfirm:n,onCancel:d,title:u}){return e.jsx("div",{className:"aam_modal",children:e.jsxs("div",{className:"aam_modal__content",children:[e.jsx("h3",{className:"aam_modal__title",children:"Удаление новости"}),e.jsxs("p",{className:"aam_modal__text",children:["Вы уверены, что хотите удалить новость ",e.jsx("strong",{children:u}),"?"]}),e.jsxs("div",{className:"aam_modal__actions",children:[e.jsx(C,{type:"submit",label:"Удалить",variant:"danger",onClick:n}),e.jsx(C,{type:"reset",label:"Отмена",variant:"green",onClick:d})]})]})})}function O(){const{role:n}=B();if(n!=="admin"&&n!=="superadmin")return e.jsx("p",{children:"У вас нет прав для управления новостями."});const[d,u]=s.useState({}),[h,o]=s.useState(!0),[i,m]=s.useState(!1),[_,y]=s.useState(null),[p,f]=s.useState(null),j=()=>{o(!0);const c=localStorage.getItem("authToken");fetch("/api/admin/news",{headers:{Authorization:`Bearer ${c}`}}).then(async r=>{if(!r.ok)throw new Error("Ошибка загрузки новостей");const g=await r.json();u(g)}).catch(r=>console.error("Ошибка загрузки новостей:",r)).finally(()=>o(!1))};s.useEffect(()=>{j()},[]);const x=async()=>{if(!p)return;const c=localStorage.getItem("authToken");try{const r=await fetch(`/api/admin/news/${p}`,{method:"DELETE",headers:{Authorization:`Bearer ${c}`}});if(!r.ok){const g=await r.json();throw new Error(g?.error||"Ошибка удаления новости")}f(null),j()}catch(r){alert(r.message)}};if(h)return e.jsx("p",{children:"Загрузка новостей..."});const N=Object.entries(d);return e.jsxs("div",{className:"aam_news-manager",children:[e.jsx("h2",{children:"Управление новостями"}),e.jsx("button",{className:"aam-news-btn aam-news-btn--add",onClick:()=>m(!0),children:"➕ Новая новость"}),N.length===0?e.jsx("p",{children:"Новостей пока нет."}):e.jsxs("table",{className:"aam_news-manager__table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Slug"}),e.jsx("th",{children:"Priority"}),e.jsx("th",{children:"Дата"}),e.jsx("th",{children:"Заголовок (RU)"}),e.jsx("th",{children:"Действия"})]})}),e.jsx("tbody",{children:N.map(([c,r])=>e.jsxs("tr",{children:[e.jsx("td",{children:c}),e.jsx("td",{children:r.slug}),e.jsx("td",{children:r.priority}),e.jsx("td",{children:r.dates.date?new Date(r.dates.date).toLocaleDateString("ru-RU"):"-"}),e.jsx("td",{children:r.titles.ru||"-"}),e.jsxs("td",{children:[e.jsx("button",{className:"aam-news-btn aam-news-btn--edit",onClick:()=>y({id:c,...r}),children:"✏️"}),e.jsx("button",{className:"aam-news-btn aam-news-btn--delete",onClick:()=>f(c),children:"🗑️"})]})]},c))})]}),i&&e.jsx(L,{onClose:()=>m(!1),onCreated:j}),_&&e.jsx(M,{news:_,onClose:()=>y(null),onUpdated:j}),p&&e.jsx(P,{username:d[p]?.titles.ru||`Новость #${p}`,onConfirm:x,onCancel:()=>f(null)})]})}export{O as default};
//# sourceMappingURL=NewsManager-Bc3TZv2s.js.map
